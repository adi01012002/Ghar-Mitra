import{r as a,u as w,j as e,a as v,R as N,b as S,c as k,L as j}from"./index-BusJa6OU.js";import{l as O,r as C}from"./authActions-kiscr2Ki.js";const P="https://ghar-mitra-backend.onrender.com",E=({email:s,onVerified:c})=>{const[d,b]=a.useState(""),[n,t]=a.useState(""),[o,m]=a.useState(!1),p=w(),x=async i=>{var u,h;i.preventDefault(),m(!0),t("");try{const r=s.trim(),g=d.trim();console.log("Verifying OTP with:",{email:r,otp:g});const y=await v.post(`${P}/auth/verify-otp`,{email:r,otp:g});t(y.data.message),setTimeout(()=>{c?c():p("/login")},1500)}catch(r){t(((h=(u=r.response)==null?void 0:u.data)==null?void 0:h.message)||"Failed to verify OTP. Please try again.")}m(!1)};return e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",background:"#f5f5f5"},children:e.jsxs("div",{style:{background:"#fff",boxShadow:"0 2px 8px #0001",borderRadius:12,padding:32,width:"100%",maxWidth:400,border:"1px solid #e5e7eb"},children:[e.jsx("h2",{style:{fontSize:24,fontWeight:"bold",marginBottom:8},children:"Verify Email"}),e.jsxs("p",{style:{color:"#374151",fontSize:14,marginBottom:24},children:["Enter the 4-digit OTP sent to ",e.jsx("b",{children:s})]}),e.jsxs("form",{onSubmit:x,children:[e.jsx("input",{type:"text",value:d,onChange:i=>b(i.target.value),maxLength:4,pattern:"\\d{4}",required:!0,placeholder:"Enter OTP",style:{width:"100%",padding:"10px",border:"1px solid #ccc",borderRadius:6,marginBottom:16,textAlign:"center",fontSize:18,letterSpacing:8}}),e.jsx("button",{type:"submit",disabled:o,style:{width:"100%",padding:"10px",color:"#fff",background:o?"#60a5fa":"#2563eb",border:"none",borderRadius:6,fontWeight:600,cursor:o?"not-allowed":"pointer",opacity:o?.5:1,marginBottom:10},children:"Verify OTP"}),n&&e.jsx("p",{style:{color:n.includes("success")?"#16a34a":"#dc2626",fontSize:13,textAlign:"center",marginTop:8},children:n})]})]})})},T=({isLogin:s,onSubmit:c})=>{const d=S(),b=w(),{loading:n}=k(l=>l.auth),[t,o]=a.useState({username:"",email:"",password:"",role:"student"}),[m,p]=a.useState(!1),[x,i]=a.useState(""),[u,h]=a.useState(!1),r=a.useCallback(l=>{o(f=>({...f,[l.target.name]:l.target.value}))},[]),g=async l=>{if(l.preventDefault(),!n){if(!s&&!u){alert("Please accept the Terms and Conditions");return}if(s)d(O({email:t.email,password:t.password})),c&&c({email:t.email,password:t.password});else try{await d(C(t)),i(t.email),p(!0)}catch(f){alert("Registration error: "+(f.message||f))}}},y=()=>{p(!1),i(""),b("/login")};return m&&x?e.jsx(a.Suspense,{fallback:e.jsx("div",{children:"Loading OTP Verification..."}),children:e.jsx(E,{email:x,onVerified:y})}):e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-[#f7f5ff]",children:e.jsxs("div",{className:"w-full max-w-lg bg-white border border-gray-400 rounded-2xl shadow-md p-10",children:[e.jsx("h2",{className:"text-3xl font-bold mb-2 text-gray-900",children:s?"Login":"Create an account"}),e.jsxs("form",{onSubmit:g,children:[!s&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-base font-semibold text-gray-900 mb-1",children:"Username"}),e.jsx("input",{type:"text",name:"username",value:t.username,onChange:r,required:!0,className:"w-full px-4 py-3 border border-gray-400 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 text-gray-900 bg-white",placeholder:"Enter your username"})]})}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-base font-semibold text-gray-900 mb-1",children:"Your email"}),e.jsx("input",{type:"email",name:"email",value:t.email,onChange:r,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter your email"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-base font-semibold text-gray-900 mb-1",children:"Password"}),e.jsx("input",{type:"password",name:"password",value:t.password,onChange:r,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter your password"})]}),!s&&e.jsxs("div",{children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-base font-semibold text-gray-900 mb-1",children:"Role"}),e.jsx("select",{name:"role",value:t.role,onChange:r,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:e.jsx("option",{value:"pgOwner",children:"PG Owner"})})]}),e.jsxs("div",{className:"flex items-start mt-4",children:[e.jsx("input",{type:"checkbox",id:"terms",checked:u,onChange:l=>h(l.target.checked),className:"w-4 h-4 mt-0 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsxs("label",{htmlFor:"terms",className:"ml-2 text-sm text-gray-900 leading-snug",children:["I accept the"," ",e.jsx("a",{href:"#",className:"text-purple-600 hover:text-purple-800 underline",children:"Terms and Conditions"})]})]})]}),e.jsx("button",{type:"submit",disabled:n,className:`w-full py-3 px-4 rounded-xl text-white font-semibold text-lg mt-4 ${n?"bg-purple-300":"bg-purple-600 hover:bg-purple-700"} focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2`,children:n?"Processing...":s?"Login":"Create an account"})]}),s&&e.jsx("p",{className:"mt-4 text-center text-sm",children:e.jsx(j,{to:"/forgot-password",className:"text-purple-600 hover:underline",children:"Forgot Password?"})}),s?e.jsxs("p",{className:"mt-6 text-center text-sm text-gray-600",children:["Don't have an account? ",e.jsx(j,{to:"/register",className:"text-blue-600 hover:underline",children:"Register here"})]}):e.jsxs("p",{className:"mt-6 text-center text-sm text-gray-600",children:["Already have an account? ",e.jsx(j,{to:"/login",className:"text-blue-600 hover:underline",children:"Login here"})]})]})})},F=N.memo(T);export{F as A};
